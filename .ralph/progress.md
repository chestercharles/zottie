# zottie Development Progress

See `.ralph/history/completed-progress.md` for completed features.

## Current Next Steps

- Implement "iOS-style bottom sheet for adding pantry items"
- Implement "iOS-style bottom sheet for adding shopping list items"

## Recently Completed

### Swipe actions for quick status changes on pantry items

**Backend (API) changes:**
- Updated `PantryItemUpdate` schema in `src/types.ts` to include optional `itemType` field
- Updated `PantryItemUpdateEndpoint` in `src/endpoints/pantryItemUpdate.ts`:
  - Now accepts `itemType` in request body
  - Imports `PantryItemType` type from db schema
  - Updates itemType when provided in request

**Frontend (Mobile) changes:**
- Updated `UpdatePantryItemRequest` type to include optional `itemType`
- Updated `useUpdatePantryItem` hook to accept `itemType` parameter
- Updated `PantryListScreen` with swipe actions:
  - Added `Swipeable` from `react-native-gesture-handler` to `PantryItemRow` component
  - Swipe left reveals an action button (ellipsis icon)
  - Tapping action button opens iOS-native action sheet via `ActionSheetIOS`
  - **Staple items** show: "Mark as Running Low", "Mark as Out of Stock", "Delete Item"
  - **Planned items** show: "Mark as Running Low", "Finished - Remove from Pantry", "Finished - Convert to Staple", "Delete Item"
  - "Convert to Staple" changes item type to 'staple' and sets status to 'out_of_stock' so it appears on shopping list
- Added `swipeAction` style for the swipe button (blue background, rounded)

**Testing:**
- All API tests passing (46 tests)
- TypeScript compilation successful for both API and mobile
- Mobile linting passing

### Visual indicator distinguishes planned items from staples

**Frontend (Mobile) changes:**
- Updated `PantryItemRow` component in `features/pantry/PantryListScreen.tsx`
- Added `Ionicons` import from `@expo/vector-icons`
- Added a small pricetag icon (`pricetag-outline`) next to item names for planned items in the main list
- Icon only displays when `itemType === 'planned'` AND `status !== 'planned'` (purchased planned items)
- Items in the collapsible "Planned Items" section do not show the icon (already visually grouped)
- Icon is subtle: 14px size, purple (#9B59B6) color with 0.8 opacity
- Added `itemNameContainer` style for flex row layout with gap

**Testing:**
- TypeScript compilation successful
- Mobile linting passing

### Leave a household

**Backend (API) changes:**
- Created `HouseholdLeaveEndpoint` at `POST /api/household/leave`
- Endpoint removes user from current household membership
- Creates a new empty household for the user with default name "My Household"
- If user was the last member, permanently deletes the old household and all its data (pantry items, invites)

**Frontend (Mobile) changes:**
- Added `leaveHousehold` API function in `features/household/api.ts`
- Added `LeaveHouseholdResponse` type in `features/household/types.ts`
- Created `useLeaveHousehold` hook with React Query mutation
  - Invalidates household, householdMembership, and pantryItems queries on success
- Updated `SettingsScreen`:
  - Added "Leave Household" button below members list (red styling with exit icon)
  - Confirmation dialog shows context-aware message:
    - If only member: warns about permanent data deletion
    - If other members exist: explains they'll lose access to shared pantry
  - Button shows "Leaving..." state while processing

**Testing:**
- TypeScript compilation successful for both API and mobile
- Mobile linting passing
